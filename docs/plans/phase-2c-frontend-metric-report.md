# Phase 2-C: å‰ç«¯ UI â€” æŒ‡æ ‡ç®¡ç† + æŠ¥å‘Šä¸­å¿ƒ + æ•°æ®æƒé™ç®¡ç†

## ç›®æ ‡

å®ç°æŒ‡æ ‡ç®¡ç†é¡µé¢ (MetricPage)ã€æŠ¥å‘Šä¸­å¿ƒé¡µé¢ (ReportPage)ã€æ•°æ®æƒé™ç®¡ç†é¡µé¢ (DataPermissionPage) çš„å®Œæ•´å‰ç«¯ UIã€‚ä½¿ç”¨ Mock æ•°æ®é©±åŠ¨ã€‚

---

## å‰ç½®æ¡ä»¶

- Phase 1 éª¨æ¶æ­å»ºå®Œæˆ
- Phase 2-A æ•°æ®ç®¡ç†é¡µé¢å·²å®Œæˆ (å¤ç”¨éƒ¨åˆ†ç»„ä»¶é£æ ¼)
- `/metrics`, `/reports`, `/data-permissions` è·¯ç”±åŠå ä½é¡µé¢å·²å­˜åœ¨

---

## 2C.1 æŒ‡æ ‡ç®¡ç†é¡µé¢ (MetricPage)

**ä¿®æ”¹æ–‡ä»¶**: `frontend/src/pages/MetricPage.tsx`

### é¡µé¢å¸ƒå±€

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“Š æŒ‡æ ‡ç®¡ç†           [æ–°å»ºæŒ‡æ ‡] [æ–°å»ºç»´åº¦]  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ åˆ†ç±»ç­›é€‰  â”‚                                â”‚
â”‚          â”‚     æŒ‡æ ‡å¡ç‰‡ç½‘æ ¼                  â”‚
â”‚ - å…¨éƒ¨   â”‚     MetricList                  â”‚
â”‚ - é”€å”®   â”‚                                 â”‚
â”‚ - è´¢åŠ¡   â”‚     æ¯å¡ç‰‡: åç§° / å…¬å¼ / ç»´åº¦    â”‚
â”‚ - è¿è¥   â”‚     çŠ¶æ€ / æ“ä½œæŒ‰é’®              â”‚
â”‚          â”‚                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æŒ‡æ ‡åˆ—è¡¨ (MetricList)

**æ–°å¢æ–‡ä»¶**: `frontend/src/components/metric/MetricList.tsx`

- [ ] å¡ç‰‡ç½‘æ ¼å¸ƒå±€ (3 åˆ—å“åº”å¼)
- [ ] å¡ç‰‡å†…å®¹: æŒ‡æ ‡åã€è‹±æ–‡åã€å…¬å¼ã€å…³è”è¡¨ã€ç»´åº¦æ ‡ç­¾ã€çŠ¶æ€
- [ ] çŠ¶æ€æ ‡ç­¾: active (ç»¿) / draft (ç°) / deprecated (çº¢)
- [ ] æ“ä½œ: ç¼–è¾‘ / åˆ é™¤ / å¤åˆ¶
- [ ] æœç´¢æ¡† (æŒ‰åç§°/è‹±æ–‡åæ¨¡ç³Šæœç´¢)
- [ ] åˆ†ç±»ä¾§æ ç­›é€‰

### æŒ‡æ ‡è¡¨å• (MetricForm)

**æ–°å¢æ–‡ä»¶**: `frontend/src/components/metric/MetricForm.tsx`

- [ ] Modal å¼¹çª—å¼è¡¨å•
- [ ] å­—æ®µ: æŒ‡æ ‡åã€è‹±æ–‡åã€æè¿°ã€å…¬å¼ (ä»£ç ç¼–è¾‘å™¨é£æ ¼)ã€å…³è”è¡¨ (ä¸‹æ‹‰é€‰æ‹©)ã€ç»´åº¦ (å¤šé€‰æ ‡ç­¾)ã€è¿‡æ»¤æ¡ä»¶ (å¯å¢åˆ )ã€æ—¶é—´ç²’åº¦ (å¤šé€‰)ã€åˆ†ç±»ã€çŠ¶æ€
- [ ] åˆ›å»º/ç¼–è¾‘æ¨¡å¼åˆ‡æ¢
- [ ] è¡¨å•æ ¡éªŒ

### ç»´åº¦ç®¡ç†

- [ ] Tab åˆ‡æ¢: æŒ‡æ ‡ | ç»´åº¦ | ä¸šåŠ¡æœ¯è¯­
- [ ] ç»´åº¦åˆ—è¡¨: è¡¨æ ¼å±•ç¤º (åç§°ã€è‹±æ–‡åã€å…³è”è¡¨ã€å…³è”åˆ—ã€å±‚çº§)
- [ ] ä¸šåŠ¡æœ¯è¯­åˆ—è¡¨: è¡¨æ ¼å±•ç¤º (æœ¯è¯­ã€æ ‡å‡†åã€ç±»å‹)
- [ ] å„ Tab æ”¯æŒ CRUD

---

## 2C.2 æŠ¥å‘Šä¸­å¿ƒé¡µé¢ (ReportPage)

**ä¿®æ”¹æ–‡ä»¶**: `frontend/src/pages/ReportPage.tsx`

### é¡µé¢å¸ƒå±€

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“ æŠ¥å‘Šä¸­å¿ƒ             [æ–°å»ºæŠ¥å‘Š] [å®šæ—¶ä»»åŠ¡]  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Tab: [æˆ‘çš„æŠ¥å‘Š] [æ¨¡æ¿åº“] [å®šæ—¶ä»»åŠ¡]            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                              â”‚
â”‚  æŠ¥å‘Šå¡ç‰‡ç½‘æ ¼ / æ¨¡æ¿å¡ç‰‡ / ä»»åŠ¡åˆ—è¡¨           â”‚
â”‚                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æŠ¥å‘Šåˆ—è¡¨ (ReportList)

**æ–°å¢æ–‡ä»¶**: `frontend/src/components/report/ReportList.tsx`

- [ ] å¡ç‰‡ç½‘æ ¼å¸ƒå±€
- [ ] å¡ç‰‡å†…å®¹: æ ‡é¢˜ã€ç±»å‹ (æ‰‹åŠ¨/å®šæ—¶)ã€çŠ¶æ€ã€åˆ›å»ºæ—¶é—´ã€é¢„è§ˆç¼©ç•¥
- [ ] çŠ¶æ€æ ‡ç­¾: draft (ç°) / generating (è“) / ready (ç»¿) / failed (çº¢)
- [ ] æ“ä½œ: æŸ¥çœ‹ / ç¼–è¾‘ / å¯¼å‡º (PDF/HTML) / åˆ é™¤
- [ ] æœç´¢ + ç­›é€‰

### æŠ¥å‘Šç¼–è¾‘å™¨ (ReportEditor)

**æ–°å¢æ–‡ä»¶**: `frontend/src/components/report/ReportEditor.tsx`

- [ ] Markdown ç¼–è¾‘å™¨ (å·¦ç¼–è¾‘ / å³é¢„è§ˆ åŒæ )
- [ ] æŠ¥å‘Šé…ç½®: æ ‡é¢˜ã€å…³è”æ•°æ®è¡¨/æŒ‡æ ‡
- [ ] AI ç”ŸæˆæŒ‰é’® (mock: è°ƒç”¨å 2s æ¨¡æ‹Ÿç”Ÿæˆ)
- [ ] åµŒå…¥å›¾è¡¨é…ç½® (ChartConfig ç¼–è¾‘)
- [ ] ä¿å­˜/å¯¼å‡º

### å®šæ—¶ä»»åŠ¡ç®¡ç† (ScheduleManager)

**æ–°å¢æ–‡ä»¶**: `frontend/src/components/report/ScheduleManager.tsx`

- [ ] ä»»åŠ¡åˆ—è¡¨ (è¡¨æ ¼): åç§°ã€å…³è”æ¨¡æ¿ã€Cron è¡¨è¾¾å¼ (å¯è¯»æè¿°)ã€çŠ¶æ€ã€ä¸Šæ¬¡è¿è¡Œã€ä¸‹æ¬¡è¿è¡Œ
- [ ] åˆ›å»ºä»»åŠ¡ Modal: åç§°ã€æ¨¡æ¿é€‰æ‹©ã€Cron é…ç½® (é¢„è®¾é€‰é¡¹ + è‡ªå®šä¹‰)
- [ ] å¯ç”¨/åœç”¨ Toggle
- [ ] æ‰‹åŠ¨è§¦å‘è¿è¡Œ
- [ ] åˆ é™¤

### Cron é¢„è®¾é€‰é¡¹

| æ˜¾ç¤º | è¡¨è¾¾å¼ |
|------|--------|
| æ¯å¤© 9:00 | `0 9 * * *` |
| æ¯å‘¨ä¸€ 9:00 | `0 9 * * 1` |
| æ¯æœˆ 1 å· 9:00 | `0 9 1 * *` |
| è‡ªå®šä¹‰ | æ‰‹åŠ¨è¾“å…¥ |

---

## 2C.3 æ•°æ®æƒé™ç®¡ç†é¡µé¢ (DataPermissionPage)

**ä¿®æ”¹æ–‡ä»¶**: `frontend/src/pages/DataPermissionPage.tsx`

> ä»… `tenant_admin` / `super_admin` å¯è®¿é—®

### é¡µé¢å¸ƒå±€

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ›¡ï¸ æ•°æ®æƒé™ç®¡ç†              [æ–°å»ºè§’è‰²]     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ è§’è‰²åˆ—è¡¨  â”‚        è§’è‰²æƒé™è¯¦æƒ…              â”‚
â”‚          â”‚                                 â”‚
â”‚ - é”€å”®åˆ†æâ”‚  è¡¨çº§æƒé™ (table list + toggle)  â”‚
â”‚ - è´¢åŠ¡åªè¯»â”‚  åˆ—çº§æƒé™ (column masking)       â”‚
â”‚ - ç®¡ç†å‘˜  â”‚  è¡Œçº§è¿‡æ»¤ (filter rules)         â”‚
â”‚          â”‚  åˆ†é…ç”¨æˆ· (user list)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### åŠŸèƒ½

- [ ] è§’è‰²åˆ—è¡¨ (å·¦ä¾§): è§’è‰²åã€æè¿°ã€ç”¨æˆ·æ•°ã€åˆ›å»ºæ—¶é—´
- [ ] è§’è‰² CRUD: åˆ›å»º/ç¼–è¾‘/åˆ é™¤
- [ ] è¡¨çº§æƒé™è®¾ç½®: é€‰æ‹©è¡¨ â†’ åˆ†é…æƒé™ (read/write/admin)
- [ ] åˆ—çº§æƒé™è®¾ç½®: é€‰æ‹©è¡¨ â†’ é€‰æ‹©åˆ— â†’ å¯è§æ€§ (visible/masked/hidden) + è„±æ•è§„åˆ™
- [ ] è¡Œçº§è¿‡æ»¤è®¾ç½®: é€‰æ‹©è¡¨ â†’ æ·»åŠ  WHERE æ¡ä»¶
- [ ] ç”¨æˆ·åˆ†é…: æœç´¢ç”¨æˆ· â†’ åˆ†é…/ç§»é™¤è§’è‰²
- [ ] è„±æ•è§„åˆ™ä¸‹æ‹‰: last4 / first3 / phone / email_mask / id_card / full_mask / amount

---

## 2C.4 Store å®šä¹‰

### metricStore

**æ–°å¢æ–‡ä»¶**: `frontend/src/stores/metricStore.ts`

```typescript
interface MetricStore {
  metrics: Metric[];
  dimensions: Dimension[];
  businessTerms: BusinessTerm[];
  selectedMetricId: string | null;
  activeTab: "metrics" | "dimensions" | "terms";
  isLoading: boolean;

  loadMetrics: () => Promise<void>;
  createMetric: (data: CreateMetricRequest) => Promise<void>;
  updateMetric: (id: string, data: Partial<Metric>) => Promise<void>;
  deleteMetric: (id: string) => Promise<void>;
  // ... dimensions, terms CRUD
}
```

### reportStore

**æ–°å¢æ–‡ä»¶**: `frontend/src/stores/reportStore.ts`

```typescript
interface ReportStore {
  reports: Report[];
  templates: ReportTemplate[];
  schedules: ReportSchedule[];
  selectedReportId: string | null;
  activeTab: "reports" | "templates" | "schedules";
  isLoading: boolean;

  loadReports: () => Promise<void>;
  createReport: (data: CreateReportRequest) => Promise<void>;
  generateReport: (id: string) => Promise<void>;
  // ... templates, schedules CRUD
}
```

---

## 2C.5 ç±»å‹å®šä¹‰

**ä¿®æ”¹æ–‡ä»¶**: `frontend/src/types/index.ts`

æ–°å¢: `Metric`, `Dimension`, `BusinessTerm`, `Report`, `ReportTemplate`, `ReportSchedule`, `DataRole`, `TablePermission`, `ColumnPermission`, `RowFilter` ç­‰ç±»å‹ã€‚

---

## ä»»åŠ¡æ¸…å•

- [ ] å®šä¹‰ Metric / Dimension / BusinessTerm ç±»å‹
- [ ] å®šä¹‰ Report / ReportTemplate / ReportSchedule ç±»å‹
- [ ] å®šä¹‰ DataRole / TablePermission / ColumnPermission / RowFilter ç±»å‹
- [ ] åˆ›å»ºå„æ¨¡å— Mock æ•°æ®
- [ ] å®ç° metricStore
- [ ] å®ç° MetricList + MetricForm ç»„ä»¶
- [ ] å®ç°æŒ‡æ ‡/ç»´åº¦/æœ¯è¯­ Tab åˆ‡æ¢
- [ ] æ”¹é€  MetricPage é¡µé¢
- [ ] å®ç° reportStore
- [ ] å®ç° ReportList + ReportEditor + ScheduleManager ç»„ä»¶
- [ ] æ”¹é€  ReportPage é¡µé¢
- [ ] å®ç° DataPermissionPage (è§’è‰² + æƒé™é…ç½®)
- [ ] å“åº”å¼é€‚é…
- [ ] éªŒè¯é€šè¿‡

---

## éªŒè¯æ ‡å‡†

- [ ] `/metrics` é¡µé¢: æŒ‡æ ‡å¡ç‰‡å±•ç¤º + æœç´¢ + åˆ†ç±»ç­›é€‰ + CRUD
- [ ] `/metrics` é¡µé¢: ç»´åº¦/æœ¯è¯­ Tab åˆ‡æ¢å’Œå±•ç¤º
- [ ] `/reports` é¡µé¢: æŠ¥å‘Šåˆ—è¡¨ + æ¨¡æ¿åº“ + å®šæ—¶ä»»åŠ¡ ä¸‰ Tab
- [ ] `/reports` é¡µé¢: æŠ¥å‘Šç¼–è¾‘å™¨åŒæ å±•ç¤º
- [ ] `/reports` é¡µé¢: AI ç”ŸæˆæŒ‰é’® mock å·¥ä½œ
- [ ] `/data-permissions` é¡µé¢: è§’è‰²åˆ—è¡¨ + æƒé™é…ç½®
- [ ] `/data-permissions` é¡µé¢: è¡¨/åˆ—/è¡Œ ä¸‰çº§æƒé™é…ç½® UI
- [ ] é admin ç”¨æˆ·æ— æ³•è®¿é—® `/data-permissions`
- [ ] TypeScript ç¼–è¯‘ 0 error
- [ ] å“åº”å¼å¸ƒå±€æ­£å¸¸

---

## æ–°å¢/ä¿®æ”¹æ–‡ä»¶åˆ—è¡¨

### æ–°å¢

| æ–‡ä»¶ | è¯´æ˜ |
|------|------|
| `src/components/metric/MetricList.tsx` | æŒ‡æ ‡åˆ—è¡¨ |
| `src/components/metric/MetricForm.tsx` | æŒ‡æ ‡è¡¨å• |
| `src/components/report/ReportList.tsx` | æŠ¥å‘Šåˆ—è¡¨ |
| `src/components/report/ReportEditor.tsx` | æŠ¥å‘Šç¼–è¾‘å™¨ |
| `src/components/report/ScheduleManager.tsx` | å®šæ—¶ä»»åŠ¡ç®¡ç† |
| `src/stores/metricStore.ts` | æŒ‡æ ‡ Store |
| `src/stores/reportStore.ts` | æŠ¥å‘Š Store |
| `src/mocks/metrics.ts` | Mock æŒ‡æ ‡æ•°æ® |
| `src/mocks/reports.ts` | Mock æŠ¥å‘Šæ•°æ® |

### ä¿®æ”¹

| æ–‡ä»¶ | å˜æ›´ |
|------|------|
| `src/pages/MetricPage.tsx` | ä»å ä½æ”¹ä¸ºå®Œæ•´é¡µé¢ |
| `src/pages/ReportPage.tsx` | ä»å ä½æ”¹ä¸ºå®Œæ•´é¡µé¢ |
| `src/pages/DataPermissionPage.tsx` | ä»å ä½æ”¹ä¸ºå®Œæ•´é¡µé¢ |
| `src/types/index.ts` | æ–°å¢ Metric/Report/DataRole ç­‰ç±»å‹ |
